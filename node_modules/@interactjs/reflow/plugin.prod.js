import*as e from"../utils/arr.prod.js";import t from"../utils/is.prod.js";import{copyAction as o}from"../utils/misc.prod.js";import*as r from"../utils/pointerUtils.prod.js";import{tlbrToXywh as n}from"../utils/rect.prod.js";export function install(o){const{Interactable:s}=o;o.actions.phases.reflow=!0,s.prototype.reflow=function(s){return((o,s,l)=>{const a=t.string(o.target)?e.from(o._context.querySelectorAll(o.target)):[o.target],p=l.window.Promise,c=p?[]:null;for(const t of a){const a=o.getRect(t);if(!a)break;const f=e.find(l.interactions.list,(e=>e.interacting()&&e.interactable===o&&e.element===t&&e.prepared.name===s.name));let m;if(f)f.move(),c&&(m=f._reflowPromise||new p((e=>{f._reflowResolve=e})));else{const e=n(a),p={page:{x:e.x,y:e.y},client:{x:e.x,y:e.y},timeStamp:l.now()},c=r.coordsToEvent(p);m=i(l,o,t,s,c)}c&&c.push(m)}return c&&p.all(c).then((()=>o))})(this,s,o)}}function i(e,t,n,i,s){const l=e.interactions.new({pointerType:"reflow"}),a={interaction:l,event:s,pointer:s,eventTarget:n,phase:"reflow"};l.interactable=t,l.element=n,l.prevEvent=s,l.updatePointer(s,s,n,!0),r.setZeroCoords(l.coords.delta),o(l.prepared,i),l._doPhase(a);const{Promise:p}=e.window,c=p?new p((e=>{l._reflowResolve=e})):void 0;return l._reflowPromise=c,l.start(i,t,n),l._interacting?(l.move(a),l.end(s)):(l.stop(),l._reflowResolve()),l.removePointer(s,s),c}const s={id:"reflow",install:install,listeners:{"interactions:stop"({interaction:t},o){"reflow"===t.pointerType&&(t._reflowResolve&&t._reflowResolve(),e.remove(o.interactions.list,t))}}};export default s;
//# sourceMappingURL=plugin.prod.js.map