import{b as h,C as v,V as g,c as y,E as U,n as W,W as E}from"./vendor.4be520cf.js";import{T as H,S as K,a as N}from"./StrategySelect.db1b9f2f.js";import{T as q}from"./TradeList.7dbd6e10.js";import{V as B}from"./ValuePair.422b28cf.js";import{t as d,c as i,e as p,n as k,S as J,g as Q,h as X,B as m}from"./index.3277bc57.js";import{C as Y}from"./CandleChartContainer.1f5607a6.js";import{C as Z,T as tt}from"./TradesLog.de59ac3c.js";import{P as et}from"./PairSummary.db39523a.js";import"./GestureTap.1e432692.js";import"./install.4ca6e0c9.js";import"./install.d2933d0c.js";import"./createSeriesDataSimply.6cdf1b95.js";var st=Object.defineProperty,at=Object.getOwnPropertyDescriptor,C=(t,a,e,s)=>{for(var r=s>1?void 0:s?at(a,e):a,n=t.length-1,u;n>=0;n--)(u=t[n])&&(r=(s?u(a,e,r):u(r))||r);return s&&r&&st(a,e,r),r};let _=class extends g{constructor(){super(...arguments);this.timestampms=d,this.formatPercent=i,this.backtestResultFields=[{key:"metric",label:"Metric"},{key:"value",label:"Value"}],this.backtestsettingFields=[{key:"setting",label:"Setting"},{key:"value",label:"Value"}]}get hasBacktestResult(){return!!this.backtestResult}getSortedTrades(t){return t.trades.slice().sort((e,s)=>e.profit_ratio-s.profit_ratio)}formatPriceStake(t){return`${p(t,this.backtestResult.stake_currency_decimals)} ${this.backtestResult.stake_currency}`}get bestPair(){const t=this.getSortedTrades(this.backtestResult),a=t[t.length-1];return`${a.pair} ${i(a.profit_ratio,2)}`}get worstPair(){const a=this.getSortedTrades(this.backtestResult)[0];return`${a.pair} ${i(a.profit_ratio,2)}`}get backtestResultStats(){return[{metric:"Total Profit",value:`${i(this.backtestResult.profit_total)} | ${this.formatPriceStake(this.backtestResult.profit_total_abs)}`},{metric:"Total trades / Daily Avg Trades",value:`${this.backtestResult.total_trades} / ${this.backtestResult.trades_per_day}`},{metric:"Best day",value:`${i(this.backtestResult.backtest_best_day,2)} | ${this.formatPriceStake(this.backtestResult.backtest_best_day_abs)}`},{metric:"Worst day",value:`${i(this.backtestResult.backtest_worst_day,2)} | ${this.formatPriceStake(this.backtestResult.backtest_worst_day_abs)}`},{metric:"Win/Draw/Loss",value:`${this.backtestResult.results_per_pair[this.backtestResult.results_per_pair.length-1].wins} / ${this.backtestResult.results_per_pair[this.backtestResult.results_per_pair.length-1].draws} / ${this.backtestResult.results_per_pair[this.backtestResult.results_per_pair.length-1].losses}`},{metric:"Days win/draw/loss",value:`${this.backtestResult.winning_days} / ${this.backtestResult.draw_days} / ${this.backtestResult.losing_days}`},{metric:"Avg. Duration winners",value:k(this.backtestResult.winner_holding_avg)},{metric:"Avg. Duration Losers",value:k(this.backtestResult.loser_holding_avg)},{metric:"Rejected buy signals",value:this.backtestResult.rejected_signals},{metric:"___",value:"___"},{metric:"Max Drawdown",value:i(this.backtestResult.max_drawdown)},{metric:"Max Drawdown ABS",value:this.formatPriceStake(this.backtestResult.max_drawdown_abs)},{metric:"Drawdown start",value:d(this.backtestResult.drawdown_start_ts)},{metric:"Drawdown end",value:d(this.backtestResult.drawdown_end_ts)},{metric:"___",value:"___"},{metric:"Min balance",value:this.formatPriceStake(this.backtestResult.csum_min)},{metric:"Max balance",value:this.formatPriceStake(this.backtestResult.csum_max)},{metric:"Market change",value:i(this.backtestResult.market_change)},{metric:"___",value:"___"},{metric:"Best Pair",value:`${this.backtestResult.best_pair.key} ${i(this.backtestResult.best_pair.profit_sum)}`},{metric:"Worst Pair",value:`${this.backtestResult.worst_pair.key} ${i(this.backtestResult.worst_pair.profit_sum)}`},{metric:"Best single Trade",value:this.bestPair},{metric:"Worst single Trade",value:this.worstPair}]}get backtestResultSettings(){return[{setting:"Backtesting from",value:d(this.backtestResult.backtest_start_ts)},{setting:"Backtesting to",value:d(this.backtestResult.backtest_end_ts)},{setting:"BT execution time",value:k(this.backtestResult.backtest_run_end_ts-this.backtestResult.backtest_run_start_ts)},{setting:"Max open trades",value:this.backtestResult.max_open_trades},{setting:"Timeframe",value:this.backtestResult.timeframe},{setting:"Timerange",value:this.backtestResult.timerange},{setting:"Stoploss",value:i(this.backtestResult.stoploss,2)},{setting:"Trailing Stoploss",value:this.backtestResult.trailing_stop},{setting:"Trail only when offset is reached",value:this.backtestResult.trailing_only_offset_is_reached},{setting:"Trailing Stop positive",value:this.backtestResult.trailing_stop_positive},{setting:"Trailing stop positive offset",value:this.backtestResult.trailing_stop_positive_offset},{setting:"Custom Stoploss",value:this.backtestResult.use_custom_stoploss},{setting:"ROI",value:this.backtestResult.minimal_roi},{setting:"Use Sell Signal",value:this.backtestResult.use_sell_signal},{setting:"Sell profit only",value:this.backtestResult.sell_profit_only},{setting:"Sell profit offset",value:this.backtestResult.sell_profit_offset},{setting:"Enable protections",value:this.backtestResult.enable_protections},{setting:"Starting balance",value:this.formatPriceStake(this.backtestResult.starting_balance)},{setting:"Final balance",value:this.formatPriceStake(this.backtestResult.final_balance)},{setting:"Avg. stake amount",value:this.formatPriceStake(this.backtestResult.avg_stake_amount)},{setting:"Total trade volume",value:this.formatPriceStake(this.backtestResult.total_volume)}]}get perPairFields(){return[{key:"key",label:"Pair"},{key:"trades",label:"Buys"},{key:"profit_mean",label:"Avg Profit %",formatter:t=>i(t,2)},{key:"profit_sum",label:"Cum Profit %",formatter:t=>i(t,2)},{key:"profit_total_abs",label:`Tot Profit ${this.backtestResult.stake_currency}`,formatter:t=>p(t,this.backtestResult.stake_currency_decimals)},{key:"profit_total",label:"Tot Profit %",formatter:t=>i(t,2)},{key:"duration_avg",label:"Avg Duration"},{key:"wins",label:"Wins"},{key:"draws",label:"Draws"},{key:"losses",label:"Losses"}]}get perSellReason(){return[{key:"sell_reason",label:"Sell Reason"},{key:"trades",label:"Buys"},{key:"profit_mean",label:"Avg Profit %",formatter:t=>i(t,2)},{key:"profit_sum",label:"Cum Profit %",formatter:t=>i(t,2)},{key:"profit_total_abs",label:`Tot Profit ${this.backtestResult.stake_currency}`,formatter:t=>p(t,this.backtestResult.stake_currency_decimals)},{key:"profit_total",label:"Tot Profit %",formatter:t=>i(t,2)},{key:"wins",label:"Wins"},{key:"draws",label:"Draws"},{key:"losses",label:"Losses"}]}};C([h({required:!0})],_.prototype,"backtestResult",2);_=C([v({components:{TradeList:q,ValuePair:B}})],_);var S=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container-fluid px-0 backtestresult-container"},[e("div",{staticClass:"row d-flex justify-content-center"},[e("h3",[t._v("Backtest-result for "+t._s(t.backtestResult.strategy_name))])]),e("div",{staticClass:"row text-left ml-0"},[e("div",{staticClass:"row w-100"},[e("div",{staticClass:"col-12 col-xl-6 px-0 px-xl-0 pr-xl-1"},[e("b-card",{attrs:{header:"Strategy settings"}},[e("b-table",{attrs:{small:"",borderless:"",items:t.backtestResultSettings,fields:t.backtestsettingFields}})],1)],1),e("div",{staticClass:"col-12 col-xl-6 px-0 px-xl-0 pt-2 pt-xl-0 pl-xl-1"},[e("b-card",{attrs:{header:"Metrics"}},[e("b-table",{attrs:{small:"",borderless:"",items:t.backtestResultStats,fields:t.backtestResultFields}})],1)],1)]),e("b-card",{staticClass:"row mt-2 w-100",attrs:{header:"Results per Sell-reason"}},[e("b-table",{attrs:{small:"",hover:"",stacked:"sm",items:t.backtestResult.sell_reason_summary,fields:t.perSellReason}})],1),e("b-card",{staticClass:"row mt-2 w-100",attrs:{header:"Results per pair"}},[e("b-table",{attrs:{small:"",hover:"",stacked:"sm",items:t.backtestResult.results_per_pair,fields:t.perPairFields}})],1),e("b-card",{staticClass:"row mt-2 w-100",attrs:{header:"Single trades"}},[e("TradeList",{staticClass:"row trade-history mt-2 w-100",attrs:{trades:t.backtestResult.trades,"show-filter":!0,"stake-currency":t.backtestResult.stake_currency}})],1)],1)])},rt=[];S._withStripped=!0;const R={};var P=y(_,S,rt,!1,lt,"7271b2fe",null,null);function lt(t){for(let a in R)this[a]=R[a]}P.options.__file="src/components/ftbot/BacktestResultView.vue";var it=function(){return P.exports}(),ot=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,f=(t,a,e,s)=>{for(var r=s>1?void 0:s?ct(a,e):a,n=t.length-1,u;n>=0;n--)(u=t[n])&&(r=(s?u(a,e,r):u(r))||r);return s&&r&&ot(a,e,r),r};let b=class extends g{constructor(){super(...arguments);this.formatPercent=i}setBacktestResult(t){return t}};f([h({required:!0})],b.prototype,"backtestHistory",2);f([h({required:!1,default:""})],b.prototype,"selectedBacktestResultKey",2);f([U("selectionChange")],b.prototype,"setBacktestResult",1);b=f([v({})],b);var T=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container d-flex flex-column align-items-center"},[e("h3",[t._v("Available results:")]),e("b-list-group",{staticClass:"ml-2"},t._l(Object.entries(t.backtestHistory),function(s){var r=s[0],n=s[1];return e("b-list-group-item",{key:r,staticClass:"d-flex justify-content-between align-items-center py-1",attrs:{button:"",active:r===t.selectedBacktestResultKey},on:{click:function(u){return t.setBacktestResult(r)}}},[t._v(" "+t._s(r)+" "+t._s(n.total_trades)+" "+t._s(t.formatPercent(n.profit_total))+" ")])}),1)],1)},nt=[];T._withStripped=!0;const w={};var $=y(b,T,nt,!1,ut,"7cd63c58",null,null);function ut(t){for(let a in w)this[a]=w[a]}$.options.__file="src/components/ftbot/BacktestResultSelect.vue";var mt=function(){return $.exports}(),bt=Object.defineProperty,dt=Object.getOwnPropertyDescriptor,o=(t,a,e,s)=>{for(var r=s>1?void 0:s?dt(a,e):a,n=t.length-1,u;n>=0;n--)(u=t[n])&&(r=(s?u(a,e,r):u(r))||r);return s&&r&&bt(a,e,r),r},M,F,A,D,O,j,z,L,V;const c=W(J.ftbot);let l=class extends g{constructor(){super(...arguments);this.pollInterval=null,this.showLeftBar=!1,this.selectedTimeframe="",this.selectedDetailTimeframe="",this.strategy="",this.timerange="",this.enableProtections=!1,this.maxOpenTrades="",this.stakeAmountUnlimited=!1,this.stakeAmount="",this.startingCapital="",this.btFormMode="run",this.selectedPlotConfig=Q(X()),this.formatPercent=i}get hasBacktestResult(){return this.backtestHistory?Object.keys(this.backtestHistory).length!==0:!1}get timeframe(){try{return this.selectedBacktestResult.timeframe}catch{return""}}mounted(){this.getState()}setBacktestResult(t){this.setBacktestResultKey(t),this.strategy=this.selectedBacktestResult.strategy_name,this.selectedTimeframe=this.selectedBacktestResult.timeframe,this.selectedDetailTimeframe=this.selectedBacktestResult.timeframe_detail||"",this.timerange=this.selectedBacktestResult.timerange}clickBacktest(){const t={strategy:this.strategy,timerange:this.timerange,enable_protections:this.enableProtections},a=parseInt(this.maxOpenTrades,10);if(a&&(t.max_open_trades=a),this.stakeAmountUnlimited)t.stake_amount="unlimited";else{const s=Number(this.stakeAmount);s&&(t.stake_amount=s.toString())}const e=Number(this.startingCapital);e&&(t.dry_run_wallet=e),this.selectedTimeframe&&(t.timeframe=this.selectedTimeframe),this.selectedDetailTimeframe&&(t.timeframe_detail=this.selectedDetailTimeframe),this.startBacktest(t)}backtestRunningChanged(){this.backtestRunning===!0?this.pollInterval=window.setInterval(this.pollBacktest,1e3):this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}};M=m.backtestRunning,F=m.backtestStep,A=m.botState,D=m.backtestProgress,O=m.backtestHistory,j=m.selectedBacktestResultKey,z=m.history,L=m.selectedBacktestResult,V=m.canRunBacktest;o([c.Getter],l.prototype,M,2);o([c.Getter],l.prototype,F,2);o([c.Getter],l.prototype,A,2);o([c.Getter],l.prototype,D,2);o([c.Getter],l.prototype,O,2);o([c.Getter],l.prototype,j,2);o([c.Getter],l.prototype,z,2);o([c.Getter],l.prototype,L,2);o([c.Getter],l.prototype,V,2);o([c.Action],l.prototype,"getPairHistory",2);o([c.Action],l.prototype,"getState",2);o([c.Action],l.prototype,"startBacktest",2);o([c.Action],l.prototype,"pollBacktest",2);o([c.Action],l.prototype,"removeBacktest",2);o([c.Action],l.prototype,"stopBacktest",2);o([c.Action],l.prototype,"setBacktestResultKey",2);o([E("backtestRunning")],l.prototype,"backtestRunningChanged",1);l=o([v({components:{BacktestResultView:it,BacktestResultSelect:mt,TimeRangeSelect:H,CandleChartContainer:Y,CumProfitChart:Z,TradesLogChart:tt,StrategySelect:K,ValuePair:B,PairSummary:et,TimeframeSelect:N}})],l);var G=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container-fluid",staticStyle:{"max-height":"calc(100vh - 60px)"}},[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row mb-2"}),t.canRunBacktest?t._e():e("p",[t._v("Bot must be in webserver mode to enable Backtesting.")]),e("div",{staticClass:"row w-100"},[e("h2",{staticClass:"col-4 col-lg-3"},[t._v("Backtesting")]),e("div",{staticClass:"col-12 col-lg-order-last col-lg-6 mx-md-5 d-flex flex-wrap justify-content-md-center justify-content-between mb-4",attrs:{disabled:t.canRunBacktest}},[e("b-form-radio",{staticClass:"mx-1 flex-samesize-items",attrs:{name:"bt-form-radios",button:"",value:"run",disabled:!t.canRunBacktest},model:{value:t.btFormMode,callback:function(s){t.btFormMode=s},expression:"btFormMode"}},[t._v("Run backtest")]),e("b-form-radio",{staticClass:"mx-1 flex-samesize-items",attrs:{name:"bt-form-radios",button:"",value:"results",disabled:!t.hasBacktestResult},model:{value:t.btFormMode,callback:function(s){t.btFormMode=s},expression:"btFormMode"}},[t._v("Analyze result")]),e("b-form-radio",{staticClass:"mx-1 flex-samesize-items",attrs:{name:"bt-form-radios",button:"",value:"visualize-summary",disabled:!t.hasBacktestResult},model:{value:t.btFormMode,callback:function(s){t.btFormMode=s},expression:"btFormMode"}},[t._v("Visualize summary")]),e("b-form-radio",{staticClass:"mx-1 flex-samesize-items",attrs:{name:"bt-form-radios",button:"",value:"visualize",disabled:!t.hasBacktestResult},model:{value:t.btFormMode,callback:function(s){t.btFormMode=s},expression:"btFormMode"}},[t._v("Visualize result")])],1),e("small",{directives:[{name:"show",rawName:"v-show",value:t.backtestRunning,expression:"backtestRunning"}],staticClass:"text-right bt-running-label col-8 col-lg-3"},[t._v("Backtest running: "+t._s(t.backtestStep)+" "+t._s(t.formatPercent(t.backtestProgress,2)))])])]),e("div",{staticClass:"d-md-flex"},[e("div",{class:(t.showLeftBar?"col-md-3":"")+" sticky-top sticky-offset mr-3 d-flex flex-column"},[t.btFormMode!=="visualize"?e("b-button",{staticClass:"align-self-start",attrs:{"aria-label":"Close",size:"sm"},on:{click:function(s){t.showLeftBar=!t.showLeftBar}}},[t._v(t._s(t.showLeftBar?"<":">"))]):t._e(),e("transition",{attrs:{name:"fade",mode:"in-out"}},[t.btFormMode!=="visualize"&&t.showLeftBar?e("BacktestResultSelect",{attrs:{"backtest-history":t.backtestHistory,"selected-backtest-result-key":t.selectedBacktestResultKey},on:{selectionChange:t.setBacktestResult}}):t._e()],1)],1),t.btFormMode=="run"?e("div",{staticClass:"flex-fill row d-flex flex-column bt-config"},[e("div",{staticClass:"mb-2"},[e("span",[t._v("Strategy")]),e("StrategySelect",{model:{value:t.strategy,callback:function(s){t.strategy=s},expression:"strategy"}})],1),e("b-card",{attrs:{"bg-variant":"light",disabled:t.backtestRunning}},[e("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-lg":"2",label:"Backtest params","label-size":"sm","label-class":"font-weight-bold pt-0"}},[e("b-form-group",{attrs:{"label-cols-sm":"5",label:"Timeframe:","label-align-sm":"right","label-for":"timeframe-select"}},[e("TimeframeSelect",{attrs:{id:"timeframe-select"},model:{value:t.selectedTimeframe,callback:function(s){t.selectedTimeframe=s},expression:"selectedTimeframe"}})],1),e("b-form-group",{attrs:{"label-cols-sm":"5",label:"Detail Timeframe:","label-align-sm":"right","label-for":"timeframe-detail-select",title:"Detail timeframe, to simulate intra-candle results. Not setting this will not use this functionality."}},[e("TimeframeSelect",{attrs:{id:"timeframe-detail-select","below-timeframe":t.selectedTimeframe},model:{value:t.selectedDetailTimeframe,callback:function(s){t.selectedDetailTimeframe=s},expression:"selectedDetailTimeframe"}})],1),e("b-form-group",{attrs:{"label-cols-sm":"5",label:"Max open trades:","label-align-sm":"right","label-for":"max-open-trades"}},[e("b-form-input",{attrs:{id:"max-open-trades",placeholder:"Use strategy default",type:"number"},model:{value:t.maxOpenTrades,callback:function(s){t.maxOpenTrades=s},expression:"maxOpenTrades"}})],1),e("b-form-group",{attrs:{"label-cols-sm":"5",label:"Starting capital:","label-align-sm":"right","label-for":"starting-capital"}},[e("b-form-input",{attrs:{id:"starting-capital",type:"number",step:"0.001"},model:{value:t.startingCapital,callback:function(s){t.startingCapital=s},expression:"startingCapital"}})],1),e("b-form-group",{attrs:{"label-cols-sm":"5",label:"Stake amount:","label-align-sm":"right","label-for":"stake-amount"}},[e("div",{staticClass:"d-flex"},[e("b-form-checkbox",{staticClass:"col-md-6",attrs:{id:"stake-amount-bool"},model:{value:t.stakeAmountUnlimited,callback:function(s){t.stakeAmountUnlimited=s},expression:"stakeAmountUnlimited"}},[t._v("Unlimited stake")]),e("b-form-input",{attrs:{id:"stake-amount",type:"number",placeholder:"Use strategy default",step:"0.01",disabled:t.stakeAmountUnlimited},model:{value:t.stakeAmount,callback:function(s){t.stakeAmount=s},expression:"stakeAmount"}})],1)]),e("b-form-group",{attrs:{"label-cols-sm":"5",label:"Enable Protections:","label-align-sm":"right","label-for":"enable-protections"}},[e("b-form-checkbox",{attrs:{id:"enable-protections"},model:{value:t.enableProtections,callback:function(s){t.enableProtections=s},expression:"enableProtections"}})],1),e("hr"),e("TimeRangeSelect",{staticClass:"mt-2",model:{value:t.timerange,callback:function(s){t.timerange=s},expression:"timerange"}})],1)],1),e("h3",{staticClass:"mt-3"},[t._v("Backtesting summary")]),e("div",{staticClass:"d-flex flex-wrap flex-md-nowrap justify-content-between justify-content-md-center"},[e("b-button",{staticClass:"mx-1",attrs:{variant:"primary",disabled:t.backtestRunning||!t.canRunBacktest},on:{click:t.clickBacktest}},[t._v(" Start backtest ")]),e("b-button",{staticClass:"mx-1",attrs:{variant:"primary",disabled:t.backtestRunning||!t.canRunBacktest},on:{click:t.pollBacktest}},[t._v(" Load backtest result ")]),e("b-button",{staticClass:"mx-1",attrs:{variant:"primary",disabled:!t.backtestRunning},on:{click:t.stopBacktest}},[t._v("Stop Backtest")]),e("b-button",{staticClass:"mx-1",attrs:{variant:"primary",disabled:t.backtestRunning||!t.canRunBacktest},on:{click:t.removeBacktest}},[t._v("Reset Backtest")])],1)],1):t._e(),t.hasBacktestResult&&t.btFormMode=="results"?e("BacktestResultView",{staticClass:"flex-fill",attrs:{"backtest-result":t.selectedBacktestResult}}):t._e(),t.hasBacktestResult&&t.btFormMode=="visualize-summary"?e("div",{staticClass:"text-center flex-fill mt-2 d-flex flex-column"},[e("TradesLogChart",{staticClass:"trades-log",attrs:{trades:t.selectedBacktestResult.trades}}),e("CumProfitChart",{staticClass:"cum-profit",attrs:{trades:t.selectedBacktestResult.trades,"profit-column":"profit_abs","show-title":!0}})],1):t._e()],1),t.hasBacktestResult&&t.btFormMode=="visualize"?e("div",{staticClass:"container-fluid text-center w-100 mt-2"},[e("p",{staticClass:"row"},[t._v(" Graph will always show the latest values for the selected strategy. Strategy: "+t._s(t.strategy)+" ")]),e("div",{staticClass:"row text-center"},[e("PairSummary",{staticClass:"col-md-2 overflow-auto",staticStyle:{"max-height":"calc(100vh - 200px)"},attrs:{pairlist:t.selectedBacktestResult.pairlist,trades:t.selectedBacktestResult.trades,"sort-method":"profit","backtest-mode":!0}}),e("CandleChartContainer",{staticClass:"col-md-10 candle-chart-container px-0 w-100 h-100",attrs:{"available-pairs":t.selectedBacktestResult.pairlist,"historic-view":!0,timeframe:t.timeframe,"plot-config":t.selectedPlotConfig,timerange:t.timerange,strategy:t.strategy,trades:t.selectedBacktestResult.trades}})],1)]):t._e()])},_t=[];G._withStripped=!0;const x={};var I=y(l,G,_t,!1,ft,"76ff767f",null,null);function ft(t){for(let a in x)this[a]=x[a]}I.options.__file="src/views/Backtesting.vue";var Pt=function(){return I.exports}();export{Pt as default};
//# sourceMappingURL=Backtesting.7b95866b.js.map
